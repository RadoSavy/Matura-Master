document.addEventListener('DOMContentLoaded', function() {
    const worksData = {
        chintulov1p1: {
            title: "Стани, стани, юнак балкански",
            text: `Стани, стани юнак балкански
от сън дълбок се събуди,
срещу народа отомански
ти българите поведи!

Че сълзи кървави пролива
във робство милий наш народ;
високо той ръце простира
да го избави вишний бог!

И тъй ний много претърпяхме,
но стига толкоз да търпим,
да бъдем пак, каквито бяхме,
ил’ всинца да се изтребим. 

Докога, братя, да се губим?
Защо да се не съберем?
Така ли вечно ще се трудим
и в робство всинца да измрем?

Я вижте, братя, погледнете
на ближните нам племена!
От тях добър пример вземете
как си прославят имена!

Станете, братя, вий станете,
начало покажете вий;
и сабите си запашете,
и помощ ще ви се яви.

На помощ сърби, черногорци
със радост ще се затекат,
а и от север храбри руси
тозчас ще да се появят.

Догде е мъничка змията,
елате да се съберем!
С крака да й строшим главата,
свободни да се назовем!

Да стане лева наш балкански,
от него вятър да повей,
та полумесец отомански
под тъмен облак затъмней! 

Да си развием знамената,
да светне нашата земя,
да си прославим имената,
да гинат турски племена!`,

analysis: `Анализ на "Стани, стани, юнак балкански":
            
1. Тема: Призив за национално освобождение
2. Жанр: Патриотична песен
3. Композиция: 
   - Призив за борба
   - Описание на страданието
4. Художествени средства:
   - Метафори: "кръв обагрено", "пламък упалено"
   - Повторения: "Стани, стани"
   - Апострофа: "юнак балкански"`
        },
        chintulov2: {
            title: "Вятър ечи, Балкан стене",
            text: `Вятър ечи, Балкан стене,
Сам юнак на коня
С тръба зове свойте братя:
всички на оръжие!

Дойде време, ставайте,
от сън се събуждайте,
доста робство и тиранство,
всички на оръжие!

Който носи мъжко сърце
и българско име,
да препаше остра сабя,
знаме да развее!`,
            analysis: `Анализ на "Вятър ечи, Балкан стене":
            
1. Тема: Страданието на българския народ
2. Жанр: Лирическа песен
3. Композиция:
   - Природни образи
   - Описание на трагедията
   - Въпроси за виновниците
4. Художествени средства:
   - Олицетворение: "Балкан стене"
   - Риторични въпроси
   - Символи: "мъгла" - несигурност, "огън" - борба`
        },
        botev1p1: {
            title: "На прощаване в 1868 г.",
            text: `Не плачи, майко, не тъжи,
че станах ази хайдутин,
хайдутин, майко, бунтовник,
та тебе клета оставих
за първо чедо да жалиш!
Но кълни, майко, проклинай
таз турска черна прокуда,
дето нас млади пропъди
по тази тежка чужбина -
да ходим, да се скитаме
немили, клети, недраги!
Аз зная, майко, мил съм ти,
че може млад да загина,
ах, утре като премина
през тиха бяла Дунава!
Но кажи какво да правя,
кат ме си, майко, родила
със сърце мъжко, юнашко,
та сърце, майко, не трае
да гледа турчин, че бесней
над бащино ми огнище:
там, дето аз съм пораснал
и първо мляко засукал,
там, дето либе хубаво
черни си очи вдигнеше
и с оназ тиха усмивка
в скръбно ги сърце впиеше,
там, дето баща и братя
черни чернеят за мене!...
Ах, мале - майко юнашка!
Прости ме и веч прощавай!
Аз вече пушка нарамих
и на глас тичам народен
срещу врагът си безверни.
Там аз за мило, за драго,
за теб, за баща, за братя,
за него ще се заловя,
пък...каквото сабя покаже
и честта, майко, юнашка!
А ти 'га чуеш, майнольо,
че куршум пропей над село
и момци вече наскачат,
ти излез, майко - питай ги,
де ти е чедо остало?
Ако ти кажат, че азе
паднал съм с куршум пронизан,
и тогаз, майко, не плачи,
нито пък слушай хората,
дето ще кажат за мене
„Нехранимайка излезе“,
но иди, майко, у дома
и с сърце сичко разкажи
на мойте братя невръстни,
да помнят и те да знаят,
че и те брат са имали,
но брат им падна, загина,
затуй, че клетник не трая
пред турци глава да скланя,
сюрмашко тегло да гледа!
Кажи им, майко, да помнят,
да помнят, мене да търсят:
бяло ми месо по скали,
по скали и по орляци,
черни ми кърви в земята,
в земята, майко, черната!
Дано ми найдат пушката,
пушката, майко, сабята,
и дето срещнат душманин,
със куршум да го поздравят,
а пък със сабя помилват...
Ако ли, майко, не можеш
от милост и туй да сториш,
то 'га се сберат момите
пред назе, майко, на хоро
и дойдат мойте връстници
и скръбно либе с другарки,
ти излез, майко, послушай
със мойте братя невръстни
моята песен юнашка -
защо и как съм загинал
и какви думи издумал
пред смъртта и пред дружина...
Тъжно щеш, майко, да гледаш
ти на туй хоро весело,
и като срещнеш погледът
на мойто либе хубаво,
дълбоко ще ми въздъхнат
две сърца мили за мене -
нейното, майко, и твойто!
И две щат сълзи да капнат
на стари гърди и млади...
Но туй щат братя да видят
и кога, майко, пораснат,
като брата си ще станат -
силно да любят и мразят...
Ако ли, мале майноле,
жив и здрав стигна до село,
жив и здрав с байряк във ръка,
под байряк лични юнаци,
напети в дрехи войнишки,
с левове златни на чело,
с иглянки пушки на рамо
и с саби-змии на кръстът,
о, тогаз, майко юнашка!
О, либе мило, хубаво!
Берете цветя в градина,
късайте бръшлян и здравец,
плетете венци и китки
да кичим глави и пушки!
И тогаз с венец и китка
ти, майко, ела при мене,
ела ме, майко, прегърни
и в красно чело целуни -
красно, с две думи заветни:
свобода и смърт юнашка!
А аз ще либе прегърна
с кървава ръка през рамо
да чуй то сърце юнашко,
как тупа сърце, играе;
плачът му да спра с целувка,
сълзи му с уста да глътна...
Пък тогаз... майко, прощавай!
Ти, либе, не ме забравяй!
Дружина тръгва, отива,
пътят е страшен, но славен:
аз може млад да загина...
Но... стига ми тая награда -
да каже нявга народът:
умря сиромах за правда,
за правда и за свобода...`,
            analysis: `Анализ на "На прощаване в 1868 г.":
            
1. Тема: Прощаване с майката преди заминаване за борба
2. Жанр: Лирическа поема
3. Композиция:
   - Диалог с майката
   - Описание на тежестта на робството
4. Художествени средства:
   - Апелативни изрази: "мила майко"
   - Риторичен въпрос: "Или не знаеш..."`
        },
        vazov1p1: {
            title: "Немили-недраги - Глава 1",
            text: `Нощта беше влажна и мрачна и браилските улици пустееха. 
Студената декемврийска мъгла, която обикновено пада покрай бреговете на Дунава, 
се беше напластила в една от главните улици на града и задушаваше с отровния си дъх последните минувачи, които бързаха да се приберат у дома си.
Мъжделивите фенери, що стърчаха на почтителни разстояния по двете сграни на улицата, 
едвам прокарваха мътна и неопределена светлина през мъглата и като че още повече увеличазаха мрака. 
Всичките лавки и магазини бяха затворени вече; никаква светлина или шум не излизаше навън; 
понякога само се чуваха уединени крясъци и псувни на някои закъснели картоиграчи в някое затворено казино.
Само едно малко, тясно, защитено с железни пръчки прозорче светеше още. Това прозорче беше равно със самата земя и откриваше съществуванието на една будна кръчма,
с каквито бяха богати по онова време браилските пиаци. 
Ако се приближеше някой до ниската врата на тая кръчма и надникнеше хубаво над нея, щеше да види благодарение на слабата виделина,
дошла от един близък фенер, една вапсана дъска със следующия надпис: Народна кръчма на Знаменосецът! 
Такива чудновати надписи бяха на мода по онова време. Всяко кафене, държано от българин, имаше своята девиза; всяка кръчма, посещавана от българи,
се гордееше с някакъв гръмлив или безсмислен надпис, над тая се четяха думите: Българский лев; над оная названието: Филип Тотю, храбрий Български войвода; 
над третя думите: Свободна България, с три възклицателни. Но най-любопитни бяха лавките на тютюнджиите българи. Ето там една лавка с разтворена врата.
Вътрешната страна, сиреч тая, която гледа сега към улицата, представлява един турчин с традиционната чалма на глава и с дълъг чибук в ръката. 
Минувачът не би се заинтересувал в това изображение от много обикновена и първобитна живопис, ако да не забележеше под коленете, на турчина думите, 
раздраскани с гвоздей, вероятно от патриотина тютюнджия: Долу тираните! По-нататък, на другата тютюнджийска лавка с подобно изображение, нямаше тия думи,
но затова едното око на добрия турчин бе изчовъркано. Други тютюнджия, вероятно по патриот и по-разпален неприятел на турското племе, 
при турчина си заръчваше да изпишат и един хъш с гола сабя, който показваше вид, че се готви да заколи злополучния чалмоносец. 
Обикновено такива лавки биваха най-много посещавани от емигрантите и хъшовете. Съдържателите на тия лавки бяха въобще се „народни“. 
„Народен“ се наричаше там всякой българин, избягал от въжето, от тъмницата или от насилието на турците, 
който имаше какво-годе състояние и помагаше по силата си на бедните и презренн останки от героическите чети на Хаджи Димитра и Филип Тотя.
Всеки такъв „народен“ тютюнджия даваше на вяра тютюн на съотечествениците си, с блага надежла, че ще му се разплатят при по-добри времена; 
най-после и да му не платят — нищо няма: те са хъшове, бедни хора, казваше си той и се усмихваше.
— Бай Андо, я ми претегли още двайсет и пет драма тютюн, па го запиши при другия — казваше един дрипав, неопран и едър хъш на „народния“ тютюнджия:
— Чорбаджията — исках му тая заран пари, — но каза: утре ела. Той ми помага, не е лъжа; но ако ме излъже и утре, ще му разпукна главата на това куче…
— Крумов! — казваше един друг хъш, като се обръщаше към един бакалин: — Займи ми два франка още.
— Ще ги изпукаш и тях; знам си аз стоката… На ти петдесет бана, па се пилей!… — казваше Крумов. 
Тогава беше патриотическо да се носят гръмки прякори. Имаше още Перунов, Асенев, Балкански, Левски, Гръмников, Планински и пр.
Но нека влезем в кръчмата, на която прозорчето светеше още през нощта.
Тая кръчма беше една дълбока изба, в която се слазяше е по една стръмна и извита стълба. Една опушена и полуразбита лампа висеше на потона и осветляваше вътрешността. 
Един топъл и задушлив въздух, сгъстен от кадежа на лампата и цигарите и от киселите изпарения на питиетата, пълнеше това подземие. 
На една страна, въз една висока усамотена и измокрена полица, стоеха йерархически наредени чашите и шулците. 
На срещната стена бяха налепени няколко литографически картини, които представляваха боевете на Хаджи Димитровата чета при Върбовка,
при Караисен и клетвата, която прави същата чета на Дунавския бряг. Няма нужда да описваме подробностите на тия картини; 
те са разпространени по всичките кътове на отечеството ни и всеки от нас ги е гледал на времето с благоговение и възторг. Д
остойна за любопитството беше още една картина, изписана грубо, с ръка, залепена под горните три. На лявата й страна беше изображено нещо като село. 
Из това село излазяха няколко селяне. Пред тия селяне вървеше един стар турчин с огромна гъжва, с едно блюдо на ръцете, в което като да стоеше пита хляб. 
Срещу тая буколическа група задаваше се друга една група, състояща от въоръжени человеци, с бели хъшовски дрехи, с цървули и с калпаци, на които личеха малки левчета.
В средата се издигаше един великан, който държеше висок червен байрак със словата „Свобода или смърт!“ 
Отдолу с едри неправилни букви се разказваше съдържанието на картината, 
представляюща посрещането, което направи един турски първенец на четата, не помня добре в кое село. 
Това разказване се свършваше с думите: Да живее храбрият Странджа — знаменосец!
Една дружина от шестима души, насядали на одърчето в дъното на избата, допълняше изгледа.
Те бяха всичките хъшове или почти хъшове. Най-старият от тях, който беше най-снажен, дълголик, сух, 
жълт с гъста черна брада, се беше изтегнал до стената и от време на време изпущаше един гъстьк пушек из устата си. 
Той слушаше внимателно какво разказваше един от събеседниците му. 
Види се, че разговорът беше много интересен за него, защото сегиз-тогиз челото му, въз което личеха зарасли рани, се набърчаше отрицателно, 
или пък клюмваше утвърдително. Той често пресичаше говорящия, като викаше високо и кашляше:
— Не, не! При Саръ яр убиха Тончо Тралалата, а не в селото, лъжеш, Македонски!…
Или:
— Той беше Иванчо Гърбата… Гърбата беше, дето удари Мишева с револвера… нарочно… аз знам, че нарочно той уби Мишева, проклетникът проклети!
— Право! И аз сега ми дохожда на ум… Черкезинът беше, а не Селвели Мустафа… Право, тъй е… видях го, кога падна. Имаш право, Македонски!…
Или:
— Аз го убих, него, мръсника. Насмалко щях да изпусна знамето. Там ме раниха.
И той кашляше силно и се задавяше.
И после пак слушаше.
Оня, който разказваше, беше един висок мъж с дребно и надупчено от шарката лице, с дълги сиви мустаци и с лукави, дръзки очи. 
Той носеше едно огромно извехтяло и без копчета палто и громкото име Македонски; 
Никой не знаеше нищо от миналото му, преди да дойде от Влашко, освен това, че той бил войвода на някаква хайдушка чета в Македония. 
Може би тоя слух беше причината, дето той упражняваше осезателно влияние въз другарите си хъшове.
До него седеше турски друг един момък на възраст до трийсет години, комуто казваха Хаджият.
Той имаше лице сухо, длъгнесто, жълтеникаво, което се окончаваше с една остра брада без косми. 
По това лице ясно се виждаше изражението на уморяване и отслабване. Той навождаше главата и дремливо я клатеше, 
като се сепваше, колчем старият прекъсваше Македонски, и се изкашляше.
До Хаджият седеше други млад человек с черно и нагърчено от преждевременна старост лице, бръснато. Той гледаше много внимателно в Македонски, който разказваше, 
като често и машинално правеше движение с ръката от устата към гърдите, като че гладеше космите на невидима брада. 
Той беше поп и беше участвувал в четата на Тотя. Сега беше хъш. А казваха му Попчето.
Не с по-малко любопитство и внимание слушаше и най-младият от всичките, почти хлапак с фес. 
Той зяпаше в устата на разказвача и ловеше жадно всяка негова дума; а когато се обадеше и старият, 
вниманието му се преобръщаше на благоговение. Той впиваше вторачено очите си в жълтото и измахнато лице на стария хъш, 
гледаше как се свива набърченото му от рани и трудове чело. 
Това двайсетгодишно момче имаше всичките черти на невинността и ентусиазма. Син на един богат свищовски търговец, 
той беше зарязал тайно магазията на баща си и с парахода беше пристигнал тази вечер. Защо? И той сам не знаеше. 
Той просто беше оставил бащината си магазия, защото му беше омръзнало това тихо, сигурно и егоистично съществувание, което беше монотония. Мечтател, идеалист,
 ветреник — той искаше да вкуси от сладостта на неизвестното и новото. 
Като притурим, че той беше написал и напечатал тайно вече цяла патриотическа поема, ще разберем лесно защо беше забравил да вземе и пари за разноски.
Македонски, който случайно стоеше на пристанището тая вечер, съгледа го, запозна се с младия вагабонтин и го доведе да нощува у Странджата.
Очевидно, разказът се отнасяше до боевете и приключенията на въстаниците, що бяха нахлули в България преди три години. Старият инвалид се вълнуваше при преди три години. 
Старият инвалид се вълнуваше при възпоменанието на тия подвизи и героически нападения. Било, че настоящето му се вижда тежко и безславно, 
било, че чувствуваше охтиката в гърдите си, която се заявяваше в чести и раздразнени кашляния, 
той се сърдеше от най-малката невярност в разказа на другаря си, викаше и гневно се мусеше.
Тоя бледолик, болнав, сух като скелет человек беше Странджата, знаменосецът. Същият, който беше изписан на картината.
Той сега държеше тая кръчма.
Ето защо младото момче гледаше на него с такова страхопочитание.`,
            analysis: `Анализ на "Немили-недраги" (част 1):
            
1. Тема: Описание на природата като отражение на човешкото състояние
2. Композиция:
   - Пейзажни описания
   - Създаване на мрачна атмосфера
3. Художествени средства:
   - Олицетворение: "горите гледаха", "вятърът свиреше"
   - Епитети: "мрачни тонове", "суво и неприветливо"
   - Метафора: "мълчание на мъглата"`
        },
        vazov1p2: {
            title: "Немили-недраги - Част 2",
            text: `Сред тази пустош се издигаше малката къща на поп Коста. Тя беше като последен оплот на живота сред мъртвината. От комина сипваше се тънък дим, сякаш душата на дома си пробиваше път към небето.`,
            analysis: `Анализ на "Немили-недраги" (част 2):
            
1. Тема: Противопоставяне на човешкия живот срещу враждебната природа
2. Художествени средства:
   - Контраст: "пустош" срещу "къща"
   - Символ: "дима" като знак на живота
   - Метафора: "душата на дома" - присъствието на духовност`
        }
    };

    const modal = document.getElementById('text-modal');
const modalContent = document.querySelector('.modal-content'); // Added reference to modal content
const modalTitle = document.getElementById('modal-work-title');
const textContent = document.getElementById('text-content');
const analysisContent = document.getElementById('analysis-content');
const closeModal = document.querySelector('.close-modal');
const tabs = document.querySelectorAll('.modal-tab');

function showModal(workId, type) {
    const work = worksData[workId];
    if (!work) return;

    modalTitle.textContent = work.title;
    textContent.innerHTML = `<pre>${work.text}</pre>`;
    analysisContent.innerHTML = `<p>${work.analysis}</p>`;

    // Reset modal width before calculating new size
    modalContent.style.width = '';
    modalContent.style.minWidth = '';

    if (type === 'text') {
        document.querySelector('.modal-tab[data-tab="text"]').classList.add('active');
        document.querySelector('.modal-tab[data-tab="analysis"]').classList.remove('active');
        textContent.style.display = 'block';
        analysisContent.style.display = 'none';

        // Calculate optimal width after content is rendered
        setTimeout(() => {
            const preElement = textContent.querySelector('pre');
            if (preElement) {
                const textWidth = preElement.scrollWidth;
                const maxWidth = window.innerWidth - 40; // Account for small margins
                const optimalWidth = Math.min(textWidth + 80, maxWidth); // Add some padding
                
                modalContent.style.width = `${optimalWidth}px`;
                modalContent.style.minWidth = '300px'; // Ensure minimum width
                
                // Add class for wide content
                if (optimalWidth >= maxWidth - 20) {
                    modalContent.classList.add('wide-content');
                } else {
                    modalContent.classList.remove('wide-content');
                }
            }
        }, 10);
    } else {
        document.querySelector('.modal-tab[data-tab="analysis"]').classList.add('active');
        document.querySelector('.modal-tab[data-tab="text"]').classList.remove('active');
        textContent.style.display = 'none';
        analysisContent.style.display = 'block';
        modalContent.classList.remove('wide-content');
    }

    modal.classList.add('active');
}

// Rest of your existing event listeners remain the same...
document.querySelectorAll('.show-text').forEach(btn => {
    btn.addEventListener('click', function() {
        const workId = this.dataset.work;
        showModal(workId, 'text');
    });
});

document.querySelectorAll('.show-analysis').forEach(btn => {
    btn.addEventListener('click', function() {
        const workId = this.dataset.work;
        showModal(workId, 'analysis');
    });
});

tabs.forEach(tab => {
    tab.addEventListener('click', function() {
        const tabType = this.dataset.tab;
        
        tabs.forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        
        if (tabType === 'text') {
            textContent.style.display = 'block';
            analysisContent.style.display = 'none';
            // Recalculate width when switching to text tab
            setTimeout(() => {
                const preElement = textContent.querySelector('pre');
                if (preElement) {
                    const textWidth = preElement.scrollWidth;
                    const maxWidth = window.innerWidth - 40;
                    modalContent.style.width = `${Math.min(textWidth + 80, maxWidth)}px`;
                }
            }, 10);
        } else {
            textContent.style.display = 'none';
            analysisContent.style.display = 'block';
            modalContent.style.width = ''; 
        }
    });
});

closeModal.addEventListener('click', function() {
    modal.classList.remove('active');
});

window.addEventListener('click', function(event) {
    if (event.target === modal) {
        modal.classList.remove('active');
    }
});

window.addEventListener('resize', function() {
    if (modal.classList.contains('active')) {
        const activeTab = document.querySelector('.modal-tab.active');
