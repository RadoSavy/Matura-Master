<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BAI Ганьо - AI Асистент - Matura Master</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="css/style.css" />
  <style>
    body, html {
      margin: 0; padding: 0; min-height: 100vh;
      font-family: 'Nunito', sans-serif;
      background: #f0f4f8;
      display: flex;
      flex-direction: column;
    }
    header {
      background: #58cc02;
      padding: 1rem 2rem;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    header .logo {
      font-weight: 700;
      font-size: 1.5rem;
      letter-spacing: 2px;
      user-select: none;
    }
    nav ul {
      list-style: none;
      display: flex;
      gap: 1.5rem;
      margin: 0;
      padding: 0;
    }
    nav a {
      color: white;
      text-decoration: none;
      font-weight: 600;
      transition: color 0.3s ease;
    }
    nav a:hover, nav a:focus {
      color: #ffd800;
      outline: none;
    }
    main {
      flex: 1;
      padding: 2rem;
      max-width: 900px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      height: 70vh;
    }
    h1 {
      font-size: 2.5rem;
      color: #58cc02;
      margin-bottom: 1rem;
      user-select: none;
    }
    #chat {
        flex: 1;
        overflow-y: auto;
        background: white;
        border-radius: 12px;
        padding: 1rem;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        margin-bottom: 1rem;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        scroll-behavior: smooth;
        overflow-anchor: auto;
        height: 60vh;
    }
    #chat-anchor {
        overflow-anchor: auto;
        height: 1px;
    }
    .message {
      max-width: 70%;
      padding: 0.75rem 1rem;
      border-radius: 20px;
      font-size: 1rem;
      line-height: 1.4;
      user-select: none;
      opacity: 0;
      transform: translateY(10px);
      animation: fadeIn 0.3s ease forwards;
    }
    @keyframes fadeIn {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .message.user {
      background: #d1f7c4;
      align-self: flex-end;
      text-align: right;
    }
    .message.ai {
      background: #e6f4ea;
      align-self: flex-start;
      text-align: left;
    }
    form {
      display: flex;
      gap: 0.5rem;
    }
    textarea {
      flex: 1;
      resize: none;
      padding: 0.75rem 1rem;
      border-radius: 20px;
      border: 1px solid #ccc;
      font-size: 1rem;
      outline-offset: 2px;
      transition: border-color 0.3s ease;
      font-family: 'Nunito', sans-serif;
    }
    textarea:focus {
      border-color: #58cc02;
      outline: none;
    }
    button {
      background-color: #58cc02;
      color: rgb(255, 255, 255);
      font-weight: 700;
      border: none;
      border-radius: 50px;
      padding: 0 1.5rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    button:hover, button:focus {
      background-color: #4aa001;
      outline: none;
    }
    .quick-questions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    .quick-question {
      background: #48f178;
      border: none;
      border-radius: 20px;
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .quick-question:hover {
      background: #d1f7c4;
    }
    .typing-indicator {
      display: flex;
      gap: 0.3rem;
      padding: 0.75rem 1rem;
      align-self: flex-start;
      opacity: 0;
      transform: translateY(10px);
      animation: fadeIn 0.3s ease forwards;
    }
    .typing-dot {
      width: 8px;
      height: 8px;
      background: #58cc02;
      border-radius: 50%;
      opacity: 0.4;
      animation: typingAnimation 1.4s infinite ease-in-out;
    }
    .typing-dot:nth-child(1) { animation-delay: 0s; }
    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }
    @keyframes typingAnimation {
      0%, 60%, 100% { opacity: 0.4; transform: translateY(0); }
      30% { opacity: 1; transform: translateY(-3px); }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">Matura Master</div>
    <nav aria-label="Основна навигация">
      <ul>
        <li><a href="bulgarian.html">Български език</a></li>
        <li><a href="literature.html">Литература</a></li>
        <li><a href="baiganio.html" aria-current="page">BAI Ганьо</a></li>
        <li><a href="login.html">Изход</a></li>
      </ul>
    </nav>
  </header>
  <main>
    <h1>BAI Ганьо - Твоят AI съреволюционер</h1>
    
    <div class="quick-questions">
      <button class="quick-question">Какви са видовете частици?</button>
      <button class="quick-question">Кои са основните теми в "Под игото"?</button>
      <button class="quick-question">Как се пише "не" с глаголи?</button>
      <button class="quick-question">Кои са героите в "Железният светилник"?</button>
      <button class="quick-question">Какви са правилата за правопис на "ъ" и "ь"?</button>
    </div>
    
    <div id="chat" aria-live="polite" aria-label="Чат с BAI Ганьо">
    <div id="chat-anchor"></div>
</div>
    <form id="chat-form" aria-label="Форма за въвеждане на съобщение">
      <textarea id="chat-input" rows="2" placeholder="Напиши въпрос към BAI Ганьо..." required></textarea>
      <button type="submit" aria-label="Изпрати съобщение">Изпрати</button>
    </form>
  </main>
  <script>
    const chat = document.getElementById('chat');
    const chatForm = document.getElementById('chat-form');
    const chatInput = document.getElementById('chat-input');
    const quickQuestions = document.querySelectorAll('.quick-question');

    const knowledgeBase = {
      // Български език
      "частици": {
        answer: "Частиците в българския език са:\n1. Отрицателни (не, ни)\n2. Възклицателни (ех, ох, ах)\n3. Утвердителни (да, ами)\n4. Съединителни (и, а, но, че)\n5. Въпросителни (ли, дали, защо)",
        examples: ["Не искам да отида.", "Ех, колко хубаво!", "Ще дойдеш ли утре?"]
      },
      "правопис на не": {
        answer: "Частицата 'не' се пише:\n- ОТДЕЛНО с глаголи: не искам, не чета\n- СЛИТНО с прилагателни и наречия: неинтересен, невнимателно\nИзключение: когато има противопоставяне - 'не висок, а нисък'",
        rules: ["Не + глагол = отделно", "Не + прилагателно/наречие = слитно"]
      },
      "ъ и ь": {
        answer: "Правопис на 'ъ' и 'ь':\n1. 'Ъ' се пише:\n- След префикс пред 'я', 'ю': съюз, обезъязвим\n- В корена на думите: ъгъл, мъка\n2. 'Ь' се пише:\n- Между съгласна и 'о': шьов, жьол\n- В някои чужди думи: бульон",
        examples: ["съжалявам", "обезъяна", "шьол"]
      },
      
      // Литература
      "под игото": {
        answer: "Основни теми в 'Под игото' на Иван Вазов:\n1. Борба за национално освобождение\n2. Любов към родината\n3. Животът по време на османското владичество\n4. Човешките взаимоотношения в трудни времена\nГлавни герои: Бойчо Огнянов, Рада, дядо Йоцо",
        quotes: ["Който падне в бой за свобода, той не умира!"]
      },
      "железният светилник": {
        answer: "Герои в 'Железният светилник' на Елин Пелин:\n1. Чорбаджи Марко - главен герой, горд чорбаджия\n2. Стоян - неговият син\n3. Генка - младеж с модерни идеи\n4. Донка - момиче, в което Стоян е влюбен\nОсновен конфликт: традиции срещу модернизация",
        themes: ["Поколенията", "Традиция срещу прогрес"]
      },
      "народни песни": {
        answer: "Видове български народни песни:\n1. Юнашки песни - за исторически събития и герои\n2. Обичайни песни - за семейни и селски празници\n3. Любовни песни - за човешките чувства\n4. Трудови песни - свързани с различни занаяти\nПример: 'Край Вардара вее се бяло знаме'",
        characteristics: ["Устно предаване", "Повторение на мотиви", "Фолклорни образи"]
      }
    };

    const messages = [
      { sender: 'ai', text: 'Здравей! Аз съм BAI Ганьо, твоят AI съреволюционер по български език и литература. Как мога да ти помогна днес?' }
    ];

    function renderMessages() {
      chat.innerHTML = '';
      messages.forEach(msg => {
        const div = document.createElement('div');
        div.classList.add('message', msg.sender);
        
        if (msg.sender === 'ai' && msg.formatted) {
          div.innerHTML = msg.text;
        } else {
          div.textContent = msg.text;
        }
        
        chat.appendChild(div);
      });
      
      // Auto-scroll to bottom
      chat.scrollTop = chat.scrollHeight;
    }

    function scrollToBottom() {
      chat.scrollTop = chat.scrollHeight;
    }

    function showTypingIndicator() {
      const typingDiv = document.createElement('div');
      typingDiv.classList.add('typing-indicator');
      typingDiv.innerHTML = `
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
      `;
      chat.appendChild(typingDiv);
      scrollToBottom();
      return typingDiv;
    }

    function hideTypingIndicator(typingElement) {
      if (typingElement && typingElement.parentNode) {
        typingElement.remove();
      }
    }

    function formatAnswer(answer, examples, rules) {
      let formatted = `<p>${answer.replace(/\n/g, '</p><p>')}</p>`;
      
      if (examples && examples.length > 0) {
        formatted += `<p><strong>Примери:</strong></p><ul>`;
        examples.forEach(ex => {
          formatted += `<li>${ex}</li>`;
        });
        formatted += `</ul>`;
      }
      
      if (rules && rules.length > 0) {
        formatted += `<p><strong>Правила:</strong></p><ul>`;
        rules.forEach(rule => {
          formatted += `<li>${rule}</li>`;
        });
        formatted += `</ul>`;
      }
      
      return formatted;
    }

    function containsEnglish(text) {
      return /[a-zA-Z]/.test(text);
    }

    function findBestAnswer(userText) {
      const lower = userText.toLowerCase();
      
      // Проверка за конкретни въпроси
      if (lower.includes('частиц') || lower.includes('видове частиц')) {
        return {
          text: formatAnswer(
            knowledgeBase["частици"].answer,
            knowledgeBase["частици"].examples
          ),
          formatted: true
        };
      }
      
      if (lower.includes('не ') || lower.includes('правопис на не')) {
        return {
          text: formatAnswer(
            knowledgeBase["правопис на не"].answer,
            null,
            knowledgeBase["правопис на не"].rules
          ),
          formatted: true
        };
      }
      
      if (lower.includes('ъ ') || lower.includes('ь ') || lower.includes('ъ и ь')) {
        return {
          text: formatAnswer(
            knowledgeBase["ъ и ь"].answer,
            knowledgeBase["ъ и ь"].examples
          ),
          formatted: true
        };
      }
      
      if (lower.includes('под игото') || lower.includes('вазов')) {
        return {
          text: formatAnswer(
            knowledgeBase["под игото"].answer,
            knowledgeBase["под игото"].quotes
          ),
          formatted: true
        };
      }
      
      if (lower.includes('железният светилник') || lower.includes('елин пелин')) {
        return {
          text: formatAnswer(
            knowledgeBase["железният светилник"].answer,
            null,
            knowledgeBase["железният светилник"].themes
          ),
          formatted: true
        };
      }
      
      if (lower.includes('народн') || lower.includes('фолклор')) {
        return {
          text: formatAnswer(
            knowledgeBase["народни песни"].answer,
            null,
            knowledgeBase["народни песни"].characteristics
          ),
          formatted: true
        };
      }
      
      // Общи въпроси
      if (lower.includes('правопис') || lower.includes('правописн')) {
        return { 
          text: 'В българския език има много правописни правила. За кое конкретно правило искаш да научиш? Например:\n- Правопис на "не"\n- Употреба на "ъ" и "ь"\n- Глаголни окончания\n- Главни и малки букви',
          formatted: false
        };
      }
      
      if (lower.includes('литература') || lower.includes('книг') || lower.includes('произведени')) {
        return { 
          text: 'Българската литература е богата и разнообразна! За кое произведение или автор искаш да научиш повече? Например:\n- "Под игото" на Иван Вазов\n- "Железният светилник" на Елин Пелин\n- Български народни приказки и песни\n- Поезия на Христо Ботев',
          formatted: false
        };
      }
      
      if (lower.includes('тест') || lower.includes('упражнен')) {
        return { 
          text: 'Искаш ли да направим упражнение? Мога да ти задам въпроси по:\n1. Правопис\n2. Граматика\n3. Литературни произведения\n4. Автори и творби\nИзбери тема и започваме!',
          formatted: false
        };
      }
      
      if (lower.includes('консултация') || lower.includes('учител')) {
        return { 
          text: 'Ако имаш трудности с някоя тема, наистина е добра идея да потърсиш помощ от учителя си. Мога да ти помогна с:\n- Обяснение на трудни теми\n- Примери и правила\n- Подготовка за изпит\nНо за персонализирана помощ учителят е най-добрият избор!',
          formatted: false
        };
      }
      
      // Ако не разпознаем въпроса
      const randomResponses = [
        "Интересен въпрос! Можеш ли да го зададеш по-конкретно?",
        "Все още се уча, но ще се опитам да помогна. За коя точно тема питаш?",
        "Имам много информация за български език и литература. Фокусирай въпроса си малко повече.",
        "Попитай ме за конкретно правило, произведение или автор и ще ти помогна!"
      ];
      return { 
        text: randomResponses[Math.floor(Math.random() * randomResponses.length)],
        formatted: false
      };
    }

    chatForm.addEventListener('submit', function(e) {
  e.preventDefault();
  const userText = chatInput.value.trim();
  if (!userText) return;

  function containsEnglish(text) {
    return /[A-Za-z]/.test(text);
  }

  function showTypingIndicator() {
    const typingDiv = document.createElement('div');
    typingDiv.classList.add('typing-indicator');
    typingDiv.innerHTML = `
      <div class="typing-dot"></div>
      <div class="typing-dot"></div>
      <div class="typing-dot"></div>
    `;
    chat.appendChild(typingDiv);
    chat.scrollTop = chat.scrollHeight;
    return typingDiv;
  }

  function hideTypingIndicator(el) {
    if (el && el.parentNode) el.remove();
  }

  if (containsEnglish(userText)) {
    // Покажи съобщението на потребителя
    messages.push({ sender: 'user', text: userText });
    renderMessages();
    chatInput.value = '';

    // Покажи "писане..."
    const typingEl = showTypingIndicator();

    setTimeout(() => {
      hideTypingIndicator(typingEl);

      // Случайно съобщение на бай Ганьо
      const ganioPhrases = [
        "Абе, момко, тука да не ти е Америка?! Пиши на кирилица, че ме хваща екземата!",
        "Я пак! К‘ви са тия латински мацаници бе? Да не си в Холивуд?!",
        "Ганьо не говори на английски! Кирилица, оти ще те върна в трети клас!",
        "Аре моля ти се, като ще пишеш на латиница, върви при английския цар, не при мене!",
        "Като видя латиница и ми пресъхва ракията! Пиши както баба ти те е учила!",
        "Това да не ти е чат с Макдоналдс?! Тука кирилицата е задължителна, момко!",
        "Пиша ти от България, не от Тексас! Айде пак и този път с букви на народа!",
        "На мен ми дай 'ъ', 'щ', 'ж'... другото го прати на някой Гугъл Транслейт!",
        "Момко, ако не видя една 'ч' и една 'ю' в изречението, нема повече да ти отговарям!"
      ];
      const randomGanioMsg = ganioPhrases[Math.floor(Math.random() * ganioPhrases.length)];
      messages.push({ sender: 'ai', text: randomGanioMsg, formatted: false });
      renderMessages();
    }, 1500);

    return;
  }

      // Добавяне на съобщението на потребителя
      messages.push({ sender: 'user', text: userText });
      renderMessages();
      chatInput.value = '';
      
      const typingElement = showTypingIndicator();
      
      setTimeout(() => {
        hideTypingIndicator(typingElement);
        const aiResponse = findBestAnswer(userText);
        messages.push({ 
          sender: 'ai', 
          text: aiResponse.text,
          formatted: aiResponse.formatted
        });
        renderMessages();
      }, 1500);
    });

    // Бързи въпроси
    quickQuestions.forEach(button => {
      button.addEventListener('click', function() {
        const question = this.textContent;
        chatInput.value = question;
        chatForm.dispatchEvent(new Event('submit'));
      });
    });

    // Инициализиране на чата
    renderMessages();
  </script>
</body>
</html>